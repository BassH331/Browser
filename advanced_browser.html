<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https://* http://*; media-src 'self' https://* http://*; connect-src 'self' https://* http://*; child-src 'self' https://* http://*; frame-src 'self' https://* http://*; object-src 'none'; base-uri 'self'; frame-ancestors 'none'; form-action 'self';">
    <title>V3X Browser - Professional Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* V3X Brand Colors */
            --v3x-primary: #4285f4;
            --v3x-primary-dark: #1a73e8;
            --v3x-secondary: #8b5cf6;
            --v3x-accent: #06b6d4;
            --v3x-success: #34a853;
            --v3x-warning: #fbbc04;
            --v3x-danger: #ea4335;
            
            /* Chrome-inspired colors */
            --chrome-bg: #202124;
            --chrome-surface: #292a2d;
            --chrome-surface-light: #35363a;
            --chrome-border: #5f6368;
            --chrome-text: #e8eaed;
            --chrome-text-secondary: #9aa0a6;
            --chrome-accent: #8ab4f8;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            
            --chrome-bg: #f5f7fb;
            --chrome-surface: #ffffff;
            --chrome-surface-light: #eef1f6;
            --chrome-border: #d6deeb;
            --chrome-text: #1f2933;
            --chrome-text-secondary: #4f5d75;
            --chrome-hover-bg: #e7ecf7;
            --chrome-active-bg: #dbe4ff;
            --v3x-primary: #2563eb;
            --v3x-hover: #1d4ed8;
            --v3x-active: #1e40af;
            --v3x-warning: #f59e0b;
            --v3x-danger: #ef4444;
            --v3x-success: #22c55e;
            --shadow-sm: 0 1px 2px 0 rgba(15, 23, 42, 0.08), 0 1px 3px 1px rgba(15, 23, 42, 0.06);
            --shadow-md: 0 12px 24px rgba(15, 23, 42, 0.08);
            --transition: all 0.2s ease-in-out;
            --history-bg: rgba(255, 255, 255, 0.98);
            --history-border: rgba(148, 163, 184, 0.35);
            --history-item-hover: #eef2ff;
            --context-menu-bg: #ffffff;
            --context-menu-shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: radial-gradient(circle at center, #140421 0%, #06020e 60%, #020007 100%);
            color: var(--chrome-text);
            min-height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Window Controls */
        .window-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--chrome-bg);
            padding: 8px 16px;
            border-bottom: 1px solid var(--chrome-border);
            -webkit-app-region: drag;
        }

        .window-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .v3x-icon {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--v3x-primary), var(--v3x-secondary));
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            -webkit-app-region: no-drag;
        }

        .control-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .control-btn.minimize { background: #ffd60a; color: #000; }
        .control-btn.maximize { background: #06d6a0; color: #000; }
        .control-btn.close { background: #ef476f; color: #fff; }

        .control-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow);
        }

        /* Tab Bar */
        .tab-bar {
            display: flex;
            background: linear-gradient(135deg, rgba(88, 28, 135, 0.65), rgba(30, 64, 175, 0.55));
            border-bottom: 1px solid rgba(192, 132, 252, 0.25);
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            backdrop-filter: blur(12px);
            box-shadow: 0 12px 32px rgba(124, 58, 237, 0.2);
        }

        .tab-bar::-webkit-scrollbar {
            display: none;
        }

        .tab {
            min-width: 220px;
            max-width: 260px;
            height: 46px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 20px;
            background: linear-gradient(145deg, rgba(55, 18, 94, 0.75), rgba(30, 64, 175, 0.45));
            border-right: 1px solid rgba(79, 70, 229, 0.35);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            color: #ede9fe;
        }

        .tab.active {
            background: linear-gradient(145deg, rgba(109, 40, 217, 0.9), rgba(37, 99, 235, 0.65));
            border-bottom: 2px solid rgba(224, 231, 255, 0.8);
            box-shadow: inset 0 -4px 12px rgba(59, 130, 246, 0.35);
        }

        .tab:hover:not(.active) {
            background: linear-gradient(145deg, rgba(88, 28, 135, 0.8), rgba(37, 99, 235, 0.4));
            transform: translateY(-2px);
        }

        .tab-favicon {
            width: 16px;
            height: 16px;
            border-radius: 2px;
            background: var(--chrome-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .tab-title {
            flex: 1;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tab-close {
            width: 20px;
            height: 20px;
            border: none;
            background: none;
            color: var(--chrome-text-secondary);
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .tab-close:hover {
            background: var(--chrome-border);
            color: var(--chrome-text);
        }

        .new-tab-btn {
            min-width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            color: var(--chrome-text-secondary);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .new-tab-btn:hover {
            background: var(--chrome-surface-light);
            color: var(--chrome-text);
        }

        /* Navigation Bar */
        .nav-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--chrome-bg);
            border-bottom: 1px solid var(--chrome-border);
        }

        .nav-controls {
            display: flex;
            gap: 4px;
        }

        .nav-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            color: var(--chrome-text-secondary);
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .nav-btn:hover:not(:disabled) {
            background: var(--chrome-surface);
            color: var(--chrome-text);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .address-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .address-bar {
            width: 100%;
            height: 36px;
            padding: 0 40px 0 16px;
            background: var(--chrome-surface);
            border: 1px solid var(--chrome-border);
            border-radius: 18px;
            color: var(--chrome-text);
            font-size: 14px;
            font-family: inherit;
            outline: none;
            transition: all 0.2s ease;
        }

        .address-bar:focus {
            background: var(--chrome-bg);
            border-color: var(--v3x-primary);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }

        .address-bar::placeholder {
            color: var(--chrome-text-secondary);
        }

        .security-indicator {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: var(--v3x-success);
        }

        .menu-controls {
            display: flex;
            gap: 4px;
        }

        .menu-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            color: var(--chrome-text-secondary);
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
            position: relative;
        }

        .menu-btn:hover {
            background: var(--chrome-surface);
            color: var(--chrome-text);
        }

        /* Bookmarks Bar */
        .bookmarks-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            background: linear-gradient(135deg, rgba(59, 7, 100, 0.7), rgba(37, 99, 235, 0.45));
            border-bottom: 1px solid rgba(192, 132, 252, 0.2);
            overflow-x: auto;
            scrollbar-width: none;
            box-shadow: inset 0 1px 0 rgba(236, 233, 255, 0.08);
            backdrop-filter: blur(10px);
        }

        .bookmarks-bar::-webkit-scrollbar {
            display: none;
        }

        .bookmark {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 14px;
            background: rgba(109, 40, 217, 0.25);
            border: 1px solid rgba(192, 132, 252, 0.35);
            color: #ede9fe;
            font-size: 13px;
            cursor: pointer;
            border-radius: 999px;
            white-space: nowrap;
            transition: all 0.3s ease;
            box-shadow: 0 10px 24px rgba(88, 28, 135, 0.3);
            backdrop-filter: blur(6px);
        }

        .bookmark:hover {
            background: rgba(109, 40, 217, 0.55);
            transform: translateY(-3px);
            box-shadow: 0 16px 30px rgba(76, 29, 149, 0.45);
        }

        .bookmark-icon {
            width: 16px;
            height: 16px;
            font-size: 10px;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            position: relative;
            background: transparent;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .webview-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .tab-webview {
            width: 100%;
            height: 100%;
            border: none;
        }

        webview {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Side panels (history/bookmarks) */
        .side-panel {
            position: fixed;
            top: 48px;
            right: 0;
            width: 360px;
            height: calc(100% - 48px);
            background: rgba(18, 18, 18, 0.9);
            backdrop-filter: blur(16px);
            border-left: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            flex-direction: column;
            animation: slideIn 0.25s ease;
            z-index: 1500;
        }

        .side-panel.theme-light {
            background: rgba(255, 255, 255, 0.85);
            border-left: 1px solid rgba(0, 0, 0, 0.08);
        }

        .side-panel.hidden {
            display: none;
        }

        .side-panel-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .side-panel-header h3 {
            margin: 0;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .side-panel-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #bookmarkSearch {
            width: 180px;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.16);
            background: rgba(0, 0, 0, 0.2);
            color: inherit;
            outline: none;
        }

        body.theme-light #bookmarkSearch {
            border-color: rgba(0, 0, 0, 0.12);
            background: rgba(255, 255, 255, 0.8);
        }

        .close-button {
            border: none;
            background: none;
            color: inherit;
            font-size: 22px;
            cursor: pointer;
            line-height: 1;
            padding: 0 4px;
        }

        .side-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 0 16px 16px;
        }

        .side-panel-content .empty-state {
            text-align: center;
            color: var(--chrome-text-secondary);
            margin-top: 48px;
        }

        .side-panel-footer {
            padding: 12px 16px;
            font-size: 12px;
            color: var(--chrome-text-secondary);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
        }

        .side-panel .bookmark-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            gap: 12px;
        }

        .side-panel .bookmark-item:last-child {
            border-bottom: none;
        }

        .bookmark-info {
            flex: 1;
            min-width: 0;
        }

        .bookmark-info .title {
            font-size: 14px;
            font-weight: 600;
            color: var(--chrome-text);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bookmark-info .url {
            font-size: 12px;
            color: var(--chrome-text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bookmark-actions {
            display: flex;
            gap: 6px;
        }

        .bookmark-actions button {
            border: none;
            background: rgba(255, 255, 255, 0.12);
            color: inherit;
            border-radius: 4px;
            padding: 6px 8px;
            cursor: pointer;
            font-size: 12px;
        }

        body.theme-light .bookmark-actions button {
            background: rgba(0, 0, 0, 0.08);
        }

        .bookmark-actions button:hover {
            background: var(--v3x-primary);
            color: white;
        }

        /* Loading Bar */
        .loading-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 2px;
            background: var(--v3x-primary);
            border-radius: 0 0 1px 1px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .loading-bar.active {
            opacity: 1;
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 16px;
            background: var(--chrome-surface);
            border-top: 1px solid var(--chrome-border);
            font-size: 11px;
            color: var(--chrome-text-secondary);
            height: 24px;
        }

        .status-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--v3x-success);
        }

        /* Dropdown Menus */
        .dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--chrome-surface);
            border: 1px solid var(--chrome-border);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }

        .dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            color: var(--chrome-text);
            text-decoration: none;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .dropdown-item:hover {
            background: var(--chrome-surface-light);
        }

        .dropdown-separator {
            height: 1px;
            background: var(--chrome-border);
            margin: 4px 0;
        }

        /* History Panel Styles */
        #historyPanel {
            position: fixed;
            top: 48px;
            right: 0;
            width: 400px;
            height: calc(100% - 48px);
            background: var(--history-bg);
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--history-border);
        }
        
        #historyPanel.active {
            transform: translateX(0);
        }
        
        .history-header {
            padding: 16px;
            border-bottom: 1px solid var(--history-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-header h2 {
            margin: 0;
            font-size: 16px;
            font-weight: 500;
            color: var(--chrome-text);
        }

        .history-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--chrome-text-secondary);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .history-close:hover {
            background: var(--chrome-hover-bg);
        }

        .history-clear {
            background: none;
            border: 1px solid var(--history-border);
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 12px;
            color: var(--chrome-text-secondary);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .history-clear:hover {
            background: var(--chrome-hover-bg);
            color: var(--chrome-text);
        }

        .menu-shortcut {
            margin-left: auto;
            font-size: 11px;
            color: var(--chrome-text-secondary);
        }

        .separator-dot {
            margin: 0 8px;
            color: var(--chrome-text-secondary);
        }

        .hidden {
            display: none !important;
        }
        
        #historyList {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }
        
        .history-date {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            color: var(--chrome-text-secondary);
            background: var(--chrome-bg);
            margin-top: 8px;
        }
        
        .history-item {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .history-item:hover {
            background: var(--history-item-hover);
        }
        
        .history-favicon {
            margin-right: 12px;
            font-size: 16px;
            width: 24px;
            text-align: center;
        }
        
        .history-details {
            flex: 1;
            min-width: 0;
        }
        
        .history-title {
            font-size: 14px;
            color: var(--chrome-text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-url {
            font-size: 12px;
            color: var(--chrome-text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-time {
            font-size: 12px;
            color: var(--chrome-text-secondary);
            margin-left: 12px;
            white-space: nowrap;
        }
        
        .empty-state {
            padding: 32px 16px;
            text-align: center;
            color: var(--chrome-text-secondary);
            font-size: 14px;
        }
        
        /* Context Menu */
        .context-menu {
            position: fixed;
            background: var(--context-menu-bg);
            border-radius: 8px;
            box-shadow: var(--context-menu-shadow);
            padding: 8px 0;
            min-width: 200px;
            z-index: 1100;
            font-size: 14px;
            color: var(--chrome-text);
            overflow: hidden;
        }
        
        .context-menu-item {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .context-menu-item:hover {
            background: var(--chrome-hover-bg);
        }
        
        .menu-icon {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }
        
        /* New Tab Page Styles */
        #newTabPage {
            display: none;
            flex: 1 1 auto;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            width: 100%;
            background: radial-gradient(circle at top left, #32104a 0%, #1b0f35 55%, #0b0518 100%);
            padding: 48px 32px 64px;
            overflow-y: auto;
        }

        .newtab-content {
            position: relative;
            z-index: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 32px;
        }

        .starfield,
        .starfield::before,
        .starfield::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 2px;
            border-radius: 50%;
            background: transparent;
            box-shadow: 1000px 0 0 0 rgba(255, 255, 255, 0.9),
                        150px 400px 0 0 rgba(214, 173, 255, 0.7),
                        600px 200px 0 0 rgba(255, 236, 179, 0.8),
                        950px 350px 0 0 rgba(219, 112, 255, 0.9),
                        300px 700px 0 0 rgba(171, 129, 255, 0.6),
                        50px 900px 0 0 rgba(255, 255, 255, 0.8),
                        780px 600px 0 0 rgba(200, 162, 255, 0.75),
                        420px 520px 0 0 rgba(255, 214, 255, 0.85),
                        890px 120px 0 0 rgba(255, 255, 255, 0.6),
                        180px 260px 0 0 rgba(194, 135, 255, 0.8);
            animation: twinkle 12s linear infinite;
            opacity: 0.75;
        }

        .starfield::before {
            box-shadow: 40px 300px 0 0 rgba(255, 255, 255, 0.6),
                        480px 150px 0 0 rgba(215, 160, 255, 0.8),
                        720px 540px 0 0 rgba(255, 200, 255, 0.7),
                        1020px 80px 0 0 rgba(255, 255, 255, 0.85),
                        360px 620px 0 0 rgba(180, 140, 255, 0.75),
                        900px 440px 0 0 rgba(255, 226, 255, 0.9),
                        600px 860px 0 0 rgba(193, 164, 255, 0.85),
                        140px 780px 0 0 rgba(255, 255, 255, 0.65),
                        820px 300px 0 0 rgba(255, 214, 255, 0.8),
                        260px 120px 0 0 rgba(255, 255, 255, 0.75);
            animation-duration: 18s;
            animation-delay: -6s;
        }

        .starfield::after {
            box-shadow: 240px 180px 0 0 rgba(255, 255, 255, 0.65),
                        520px 360px 0 0 rgba(199, 158, 255, 0.75),
                        880px 500px 0 0 rgba(175, 130, 255, 0.8),
                        1080px 260px 0 0 rgba(255, 255, 255, 0.7),
                        460px 740px 0 0 rgba(210, 170, 255, 0.85),
                        700px 900px 0 0 rgba(255, 229, 255, 0.6),
                        80px 540px 0 0 rgba(255, 255, 255, 0.75),
                        320px 980px 0 0 rgba(198, 150, 255, 0.7),
                        640px 60px 0 0 rgba(255, 255, 255, 0.8),
                        940px 700px 0 0 rgba(255, 214, 255, 0.65);
            animation-duration: 22s;
            animation-delay: -12s;
        }

        .starfield {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes twinkle {
            0%, 100% { transform: translate3d(0, 0, 0); opacity: 0.7; }
            50% { transform: translate3d(-20px, 10px, 0); opacity: 1; }
        }

        #newTabPage .intro {
            text-align: center;
            margin-bottom: 32px;
        }

        .v3x-logo-large {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--v3x-primary), var(--v3x-secondary));
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            font-weight: bold;
            margin: 0 auto 24px;
            box-shadow: var(--shadow-lg);
        }

        .welcome-text {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--v3x-primary), var(--v3x-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tagline-large {
            font-size: 18px;
            color: var(--chrome-text-secondary);
        }

        .video-wall {
            width: 100%;
            max-width: 1100px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin: 0 auto 48px;
        }

        .video-card {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 45px rgba(86, 38, 146, 0.4);
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.6), rgba(192, 132, 252, 0.4));
            border: 1px solid rgba(192, 132, 252, 0.4);
            aspect-ratio: 16 / 9;
        }

        .video-card video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-card .video-overlay {
            position: absolute;
            bottom: 16px;
            left: 16px;
            right: 16px;
            padding: 12px 16px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.85), rgba(59, 130, 246, 0.7));
            color: #fdf4ff;
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 25px rgba(126, 58, 242, 0.4);
        }

        .floating-bookmarks-wrapper {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
        }

        .floating-bookmarks-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 12px;
        }

        .floating-bookmarks-header h2 {
            font-size: 24px;
            font-weight: 600;
            color: var(--chrome-text);
        }

        .floating-bookmarks-grid {
            position: relative;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
        }

        .bookmark-card {
            position: relative;
            padding: 22px;
            border-radius: 18px;
            background: linear-gradient(145deg, rgba(120, 74, 207, 0.92), rgba(168, 85, 247, 0.7));
            box-shadow: 0 20px 45px rgba(99, 102, 241, 0.35);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            backdrop-filter: blur(12px);
            animation: float 6s ease-in-out infinite;
            border: 1px solid rgba(224, 231, 255, 0.28);
        }

        body.theme-dark .bookmark-card {
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(88, 28, 135, 0.85));
            color: #f8fafc;
        }

        .bookmark-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 28px 55px rgba(124, 58, 237, 0.45);
        }

        .bookmark-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #faf5ff;
        }

        .bookmark-card p {
            font-size: 13px;
            color: rgba(237, 233, 254, 0.9);
        }

        .bookmark-card .bookmark-url {
            display: block;
            margin-top: 10px;
            font-size: 12px;
            color: #c4b5fd;
            word-break: break-word;
        }

        .floating-bookmarks-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: 48px 24px;
            background: rgba(76, 29, 149, 0.5);
            border-radius: 20px;
            color: rgba(226, 232, 240, 0.85);
            box-shadow: 0 20px 40px rgba(88, 28, 135, 0.4);
            backdrop-filter: blur(10px);
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-12px);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .tab {
                min-width: 120px;
                max-width: 160px;
            }
            
            .address-container {
                max-width: none;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
    </style>
</head>
<body>
    <!-- Window Controls -->
    <div class="window-controls">
        <div class="window-title">
            <div class="v3x-icon">V3X</div>
            <span>V3X Browser - Veni Vidi Vici</span>
        </div>
        <div class="control-buttons">
            <button class="control-btn minimize" id="windowMinimizeBtn" type="button">
                <i class="fas fa-minus"></i>
            </button>
            <button class="control-btn maximize" id="windowMaximizeBtn" type="button">
                <i class="fas fa-expand"></i>
            </button>
            <button class="control-btn close" id="windowCloseBtn" type="button">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Tab Bar -->
    <div class="tab-bar">
        <div class="tab active" data-tab-id="1">
            <div class="tab-favicon">üåê</div>
            <div class="tab-title">New Tab</div>
            <button class="tab-close" type="button" data-tab-close="1">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <button class="new-tab-btn" id="newTabButton" type="button">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Navigation Bar -->
    <div class="nav-bar">
        <div class="nav-controls">
            <button class="nav-btn" id="backBtn" type="button" title="Back">
                <i class="fas fa-arrow-left"></i>
            </button>
            <button class="nav-btn" id="forwardBtn" type="button" title="Forward">
                <i class="fas fa-arrow-right"></i>
            </button>
            <button class="nav-btn" id="reloadBtn" type="button" title="Reload">
                <i class="fas fa-redo"></i>
            </button>
            <button class="nav-btn" id="homeBtn" type="button" title="Home">
                <i class="fasfa-home"></i>
            </button>
        </div>

        <div class="address-container">
            <div class="security-indicator" id="securityIndicator">
                <i class="fas fa-lock"></i>
            </div>
            <input type="text" class="address-bar" id="addressBar" 
                   placeholder="Search Google or type a URL" 
                   value="chrome://newtab">
        </div>

        <div class="menu-controls">
            <button class="menu-btn" id="bookmarkBtn" type="button" title="Bookmark this page">
                <i class="fas fa-star" id="bookmarkIcon"></i>
            </button>
            <button class="menu-btn" id="downloadsBtn" type="button" title="Downloads">
                <i class="fas fa-download"></i>
            </button>
            <button class="menu-btn" id="extensionsBtn" type="button" title="Extensions">
                <i class="fas fa-puzzle-piece"></i>
            </button>
            <button class="menu-btn" id="profileBtn" type="button" title="Profile">
                <i class="fas fa-user-circle"></i>
            </button>
            <button class="menu-btn" id="mainMenuButton" type="button" title="Customize and control V3X Browser">
                <i class="fas fa-ellipsis-v"></i>
                <div class="dropdown" id="mainMenu">
                    <div class="dropdown-item" data-menu-action="openNewTab">
                        <i class="fas fa-plus"></i>
                        <span>New tab</span>
                        <span class="menu-shortcut">Ctrl+T</span>
                    </div>
                    <div class="dropdown-item" data-menu-action="openNewWindow">
                        <i class="fas fa-window-restore"></i>
                        <span>New window</span>
                        <span class="menu-shortcut">Ctrl+N</span>
                    </div>
                    <div class="dropdown-item" data-menu-action="openIncognito">
                        <i class="fas fa-user-secret"></i>
                        <span>New incognito window</span>
                        <span class="menu-shortcut">Ctrl+Shift+N</span>
                    </div>
                    <div class="dropdown-separator"></div>
                    <div class="dropdown-item" data-menu-action="openHistory">
                        <i class="fas fa-history"></i>
                        <span>History</span>
                        <span class="menu-shortcut">Ctrl+H</span>
                    </div>
                    <div class="dropdown-item" data-menu-action="openDownloads">
                        <i class="fas fa-download"></i>
                        <span>Downloads</span>
                        <span class="menu-shortcut">Ctrl+J</span>
                    </div>
                    <div class="dropdown-item" data-menu-action="openBookmarks">
                        <i class="fas fa-bookmark"></i>
                        <span>Bookmarks</span>
                        <span class="menu-shortcut">Ctrl+Shift+O</span>
                    </div>
                    <div class="dropdown-separator"></div>
                    <div class="dropdown-item" data-menu-action="openSettings">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </div>
                    <div class="dropdown-item" data-menu-action="openDevTools">
                        <i class="fas fa-code"></i>
                        <span>Developer tools</span>
                        <span class="menu-shortcut">F12</span>
                    </div>
                    <div class="dropdown-separator"></div>
                    <div class="dropdown-item" data-menu-action="showAbout">
                        <i class="fas fa-info-circle"></i>
                        <span>About V3X Browser</span>
                    </div>
                </div>
            </button>
        </div>
    </div>

    <!-- Bookmarks Bar -->
    <div class="bookmarks-bar" id="bookmarksBar">
        <button class="bookmark" type="button" data-bookmark-url="https://github.com" data-static-bookmark>
            <div class="bookmark-icon">üìÅ</div>
            <span>GitHub</span>
        </button>
        <button class="bookmark" type="button" data-bookmark-url="https://docs.github.com" data-static-bookmark>
            <div class="bookmark-icon">üìò</div>
            <span>GitHub Docs</span>
        </button>
        <button class="bookmark" type="button" data-bookmark-url="https://stackoverflow.com" data-static-bookmark>
            <div class="bookmark-icon">üí°</div>
            <span>Stack Overflow</span>
        </button>
        <button class="bookmark" type="button" data-bookmark-url="https://developer.mozilla.org" data-static-bookmark>
            <div class="bookmark-icon">üß†</div>
            <span>MDN Docs</span>
        </button>
        <button class="bookmark" type="button" data-bookmark-url="https://news.ycombinator.com">
            <div class="bookmark-icon">üì∞</div>
            <span>Hacker News</span>
        </button>
    </div>

    <!-- History Panel -->
    <div id="historyPanel">
        <div class="history-header">
            <h2>Browsing History</h2>
            <div class="history-actions">
                <button class="history-clear" id="historyClearBtn">Clear history</button>
                <button class="history-close" id="historyCloseBtn" aria-label="Close history panel">√ó</button>
            </div>
        </div>
        <div id="historyList"></div>
    </div>

    <!-- Content Area -->
    <div class="content-area">
        <div class="loading-bar" id="loadingBar"></div>
        
        <!-- New Tab Page -->
        <div id="newTabPage">
            <div class="intro">
                <div class="v3x-logo-large">V3X</div>
                <div class="welcome-text">Welcome to V3X Browser</div>
                <div class="tagline-large">Veni Vidi Vici - We Came, We Saw, We Conquered</div>
            </div>

            <div class="video-wall">
                <div class="video-card">
                    <video src="https://samplelib.com/lib/preview/mp4/sample-5s.mp4" autoplay muted loop playsinline></video>
                    <div class="video-overlay">Ambient city loop ‚Äî press play for sound</div>
                </div>
                <div class="video-card">
                    <video src="https://samplelib.com/lib/preview/mp4/sample-10s.mp4" autoplay muted loop playsinline></video>
                    <div class="video-overlay">Tech showcase reel ‚Äî stay inspired</div>
                </div>
                <div class="video-card">
                    <video src="https://samplelib.com/lib/preview/mp4/sample-12s.mp4" autoplay muted loop playsinline></video>
                    <div class="video-overlay">Creative montage ‚Äî fuel your focus</div>
                </div>
            </div>

            <div class="floating-bookmarks-wrapper">
                <div class="floating-bookmarks-header">
                    <h2>Your Floating Bookmarks</h2>
                    <span id="bookmarkCount"></span>
                </div>
                <div class="floating-bookmarks-grid" id="floatingBookmarksGrid">
                    <div class="floating-bookmarks-empty" id="floatingBookmarksEmpty">Add bookmarks to see them float here ‚ú®</div>
                </div>
            </div>
        </div>

        <!-- Webview Container -->
        <div class="webview-container hidden" id="webviewContainer"></div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-left">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="connectionStatus">Connected</span>
            </div>
            <span id="pageStatus">Ready</span>
            <span id="loadingStatus"></span>
        </div>
        <div>
            <span id="zoomLevel">100%</span>
            <span class="separator-dot">‚Ä¢</span>
            <span id="currentTime"></span>
        </div>
    </div>

    <!-- Security Exceptions Modal -->
    <div id="securityExceptionsModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="hideModal('securityExceptionsModal')">&times;</span>
            <h3>Site Security Exceptions</h3>
            <div class="exception-form">
                <input type="text" id="exceptionDomain" placeholder="example.com" class="input-field">
                <div class="exception-options">
                    <label><input type="checkbox" id="allowCookies"> Allow Cookies</label>
                    <label><input type="checkbox" id="allowServiceWorkers"> Allow Service Workers</label>
                    <label><input type="checkbox" id="allowGeolocation"> Allow Geolocation</label>
                </div>
                <button id="addExceptionBtn" class="btn-primary">Add Exception</button>
            </div>
        </div>
    </div>

    <script>
        // V3X Browser - Professional Edition
        // Complete Chrome/Firefox functionality implementation
        
        const MODERN_CHROME_UA = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36';

        class V3XBrowser {
            constructor() {
                this.tabs = new Map();
                this.currentTabId = null;
                this.nextTabId = 1;
                this.bookmarks = this.loadBookmarks();
                this.history = this.loadHistory();
                this.theme = localStorage.getItem('v3x_theme') || 'light';
                
                this.initializeUI();
                this.initializeEventListeners();
                this.initializeWebView();
                this.applyTheme();
                
                // Update time
                this.updateTime();
                
                // Initialize history panel interactions
                this.initializeHistoryPanel();

                // Attach event listeners for UI controls
                this.attachStaticEventHandlers();
                this.renderBookmarksBar();
                this.initializeBookmarkManager();
            }
            
            initializeUI() {
                this.initializeElements();
            }
            
            initializeEventListeners() {
                this.setupEventListeners();
                this.setupKeyboardShortcuts();
            }
            
            initializeWebView() {
                this.createInitialTab();
            }

            initializeHistoryPanel() {
                if (this.historyPanelListeners) {
                    return;
                }
                
                this.historyPanel = document.getElementById('historyPanel');
                this.historyList = document.getElementById('historyList');
                this.historyCloseBtn = document.getElementById('historyCloseBtn');
                this.historyClearBtn = document.getElementById('historyClearBtn');
                
                if (!this.historyPanel || !this.historyList) {
                    console.warn('History panel UI is not available.');
                    return;
                }
                
                if (this.historyCloseBtn) {
                    this.historyCloseBtn.addEventListener('click', () => this.hideHistory());
                }
                
                if (this.historyClearBtn) {
                    this.historyClearBtn.addEventListener('click', () => this.clearHistory());
                }
                
                const onDocumentClick = (event) => {
                    if (!this.historyPanel.classList.contains('active')) {
                        return;
                    }
                    
                    const isPanelClick = this.historyPanel.contains(event.target);
                    const historyButton = document.querySelector('[data-menu-action="openHistory"]');
                    const isMenuClick = historyButton ? historyButton.contains(event.target) : false;
                    
                    if (!isPanelClick && !isMenuClick) {
                        this.hideHistory();
                    }
                };
                
                const onKeyDown = (event) => {
                    const key = event.key.toLowerCase();
                    
                    if ((event.ctrlKey || event.metaKey) && key === 'h') {
                        event.preventDefault();
                        if (this.historyPanel.classList.contains('active')) {
                            this.hideHistory();
                        } else {
                            this.showHistory();
                        }
                    }
                    
                    if (key === 'escape' && this.historyPanel.classList.contains('active')) {
                        this.hideHistory();
                    }
                };
                
                document.addEventListener('click', onDocumentClick);
                document.addEventListener('keydown', onKeyDown);
                
                this.historyPanelListeners = {
                    onDocumentClick,
                    onKeyDown
                };
            }

            applyTheme() {
                const root = document.documentElement;
                const body = document.body;
                if (!root || !body) return;

                root.setAttribute('data-theme', this.theme);

                if (this.theme === 'dark') {
                    body.classList.add('theme-dark');
                    body.classList.remove('theme-light');
                } else {
                    body.classList.add('theme-light');
                    body.classList.remove('theme-dark');
                }
            }

            initializeElements() {
                this.addressBar = document.getElementById('addressBar');
                this.loadingBar = document.getElementById('loadingBar');
                this.pageStatus = document.getElementById('pageStatus');
                this.backBtn = document.getElementById('backBtn');
                this.forwardBtn = document.getElementById('forwardBtn');
                this.reloadBtn = document.getElementById('reloadBtn');
                this.homeBtn = document.getElementById('homeBtn');
                this.newTabButton = document.getElementById('newTabButton');
                this.newTabPage = document.getElementById('newTabPage');
                this.webviewContainer = document.getElementById('webviewContainer');
                this.tabBar = document.querySelector('.tab-bar');
                this.bookmarksBar = document.getElementById('bookmarksBar');
                this.floatingBookmarksGrid = document.getElementById('floatingBookmarksGrid');
                this.bookmarkCountLabel = document.getElementById('bookmarkCount');
                this.windowMinimizeBtn = document.getElementById('windowMinimizeBtn');
                this.windowMaximizeBtn = document.getElementById('windowMaximizeBtn');
                this.windowCloseBtn = document.getElementById('windowCloseBtn');
                this.bookmarkBtn = document.getElementById('bookmarkBtn');
                this.downloadsBtn = document.getElementById('downloadsBtn');
                this.extensionsBtn = document.getElementById('extensionsBtn');
                this.profileBtn = document.getElementById('profileBtn');
                this.mainMenuButton = document.getElementById('mainMenuButton');
                this.mainMenu = document.getElementById('mainMenu');
                this.securityIndicator = document.getElementById('securityIndicator');
                this.bookmarkIcon = document.getElementById('bookmarkIcon');
                this.currentTimeEl = document.getElementById('currentTime');
                this.zoomLevelEl = document.getElementById('zoomLevel');
                this.connectionStatus = document.getElementById('connectionStatus');
                this.loadingStatus = document.getElementById('loadingStatus');

                this.webviews = new Map();
                this.webviewReadyState = new Map();
                this.pendingNavigations = new Map();
                this.webview = null;

                this.bookmarksManager = document.getElementById('bookmarksManager');
                this.bookmarksList = document.getElementById('bookmarksList');
                this.bookmarkSearchInput = document.getElementById('bookmarkSearch');
                this.bookmarksCloseBtn = document.getElementById('bookmarksCloseBtn');
            }

            ensureWebview(tabId) {
                if (this.webviews.has(tabId)) {
                    return this.webviews.get(tabId);
                }

                if (!this.webviewContainer) {
                    console.error('Webview container missing');
                    return null;
                }

                const webview = document.createElement('webview');
                webview.classList.add('tab-webview', 'hidden');
                webview.setAttribute('data-tab-webview', tabId);
                webview.setAttribute('allowpopups', '');
                webview.setAttribute('useragent', MODERN_CHROME_UA);
                webview.src = 'about:blank';

                this.webviewContainer.appendChild(webview);
                this.webviews.set(tabId, webview);
                this.webviewReadyState.set(tabId, false);
                this.pendingNavigations.delete(tabId);

                this.attachWebviewEvents(webview, tabId);
                return webview;
            }

            attachWebviewEvents(webview, tabId) {
                webview.addEventListener('did-start-loading', () => this.onStartLoading(tabId));
                webview.addEventListener('did-stop-loading', () => this.onStopLoading(tabId));
                webview.addEventListener('did-navigate', (event) => this.onNavigate(event, tabId));
                webview.addEventListener('did-navigate-in-page', (event) => this.onNavigateInPage(event, tabId));
                webview.addEventListener('page-title-updated', (event) => this.onTitleUpdate(event, tabId));
                webview.addEventListener('did-fail-load', (event) => this.onLoadFail(event, tabId));
                webview.addEventListener('new-window', (event) => this.onNewWindow(event));
                webview.addEventListener('dom-ready', () => this.onDomReady(tabId));
            }

            setActiveWebview(tabId) {
                const target = this.ensureWebview(tabId);
                if (!target) return;

                this.webviews.forEach((view, id) => {
                    if (id === tabId) {
                        view.classList.remove('hidden');
                    } else {
                        view.classList.add('hidden');
                    }
                });

                this.webview = target;
            }

            getActiveWebview() {
                return this.webviews.get(this.currentTabId) || null;
            }

            isWebviewReady(tabId) {
                return this.webviewReadyState.get(tabId) === true;
            }

            setWebviewReady(tabId, ready) {
                this.webviewReadyState.set(tabId, ready);
            }

            setupEventListeners() {
                // Address bar events
                this.addressBar.addEventListener('input', () => this.onAddressInput());
                this.addressBar.addEventListener('focus', () => this.selectAddressBar());
                this.addressBar.addEventListener('blur', () => this.updateSecurityIndicator());
                this.addressBar.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        this.navigate(this.addressBar.value);
                    }
                });
                
                // Click outside to close dropdowns
                document.addEventListener('click', (e) => this.closeDropdowns(e));
            }

            attachStaticEventHandlers() {
                if (this.newTabButton) {
                    this.newTabButton.addEventListener('click', () => this.createNewTab());
                }

                if (this.windowMinimizeBtn) {
                    this.windowMinimizeBtn.addEventListener('click', () => minimizeWindow());
                }

                if (this.windowMaximizeBtn) {
                    this.windowMaximizeBtn.addEventListener('click', () => maximizeWindow());
                }

                if (this.windowCloseBtn) {
                    this.windowCloseBtn.addEventListener('click', () => closeWindow());
                }

                if (this.backBtn) {
                    this.backBtn.addEventListener('click', () => this.goBack());
                }

                if (this.forwardBtn) {
                    this.forwardBtn.addEventListener('click', () => this.goForward());
                }

                if (this.reloadBtn) {
                    this.reloadBtn.addEventListener('click', () => this.reload());
                }

                if (this.homeBtn) {
                    this.homeBtn.addEventListener('click', () => this.goHome());
                }

                if (this.bookmarkBtn) {
                    this.bookmarkBtn.addEventListener('click', () => this.toggleBookmark());
                }

                if (this.downloadsBtn) {
                    this.downloadsBtn.addEventListener('click', () => toggleDownloads());
                }

                if (this.extensionsBtn) {
                    this.extensionsBtn.addEventListener('click', () => toggleExtensions());
                }

                if (this.profileBtn) {
                    this.profileBtn.addEventListener('click', () => toggleProfile());
                }

                if (this.mainMenuButton) {
                    this.mainMenuButton.addEventListener('click', (event) => {
                        event.stopPropagation();
                        this.toggleMainMenu();
                    });
                }

                if (this.mainMenu) {
                    this.mainMenu.addEventListener('click', (event) => {
                        const target = event.target.closest('[data-menu-action]');
                        if (!target) return;
                        const action = target.getAttribute('data-menu-action');
                        if (!action) return;
                        event.stopPropagation();
                        this.toggleMainMenu();
                        switch (action) {
                            case 'openNewTab':
                                this.openNewTab();
                                break;
                            case 'openNewWindow':
                                this.openNewWindow();
                                break;
                            case 'openIncognito':
                                this.openIncognito();
                                break;
                            case 'openHistory':
                                this.openHistory();
                                break;
                            case 'openDownloads':
                                this.openDownloads();
                                break;
                            case 'openBookmarks':
                                this.openBookmarks();
                                break;
                            case 'openSettings':
                                this.openSettings();
                                break;
                            case 'openDevTools':
                                this.openDevTools();
                                break;
                            case 'showAbout':
                                this.showAbout();
                                break;
                        }
                    });
                }

                const handleBookmarkNavigation = (event) => {
                    const target = event.target.closest('[data-bookmark-url]');
                    if (!target) return;
                    const url = target.getAttribute('data-bookmark-url');
                    if (!url) return;
                    event.preventDefault();
                    this.navigate(url);
                };

                if (this.bookmarksBar) {
                    this.bookmarksBar.addEventListener('click', handleBookmarkNavigation);
                }

                if (this.floatingBookmarksGrid) {
                    this.floatingBookmarksGrid.addEventListener('click', handleBookmarkNavigation);
                }

                if (this.tabBar) {
                    this.tabBar.addEventListener('click', (event) => {
                        const closeBtn = event.target.closest('[data-tab-close]');
                        if (closeBtn) {
                            event.stopPropagation();
                            const tabId = closeBtn.getAttribute('data-tab-close');
                            if (tabId) {
                                this.closeTab(tabId);
                            }
                            return;
                        }

                        const tabElement = event.target.closest('.tab');
                        if (tabElement) {
                            const tabId = tabElement.getAttribute('data-tab-id');
                            if (tabId) {
                                this.switchToTab(tabId);
                            }
                        }
                    });
                }
            }
            
            createInitialTab() {
                const tab = {
                    id: '1',
                    title: 'New Tab',
                    url: 'chrome://newtab',
                    favicon: 'üåê',
                    isActive: true,
                    canGoBack: false,
                    canGoForward: false,
                    isLoading: false
                };
                
                this.tabs.set('1', tab);
                this.currentTabId = '1';
                this.updateTabTitle('1', tab.title);
                this.backBtn.disabled = true;
                this.forwardBtn.disabled = true;
                this.ensureWebview('1');
                this.showNewTabPage();
            }
            
            // Navigation Functions
            normalizeUrl(input) {
                if (!input) return null;

                const trimmed = input.trim();
                if (!trimmed) return null;

                if (/^chrome:\/\//i.test(trimmed)) {
                    return trimmed.toLowerCase();
                }

                if (/^[a-zA-Z][a-zA-Z0-9+.-]*:\/\//.test(trimmed)) {
                    return trimmed;
                }

                const looksLikeDomain = /^(?:[\w-]+\.)+[\w-]{2,}$/i.test(trimmed);
                if (looksLikeDomain) {
                    return `https://${trimmed}`;
                }

                const encoded = encodeURIComponent(trimmed);
                return `https://www.google.com/search?q=${encoded}`;
            }

            navigate(rawUrl) {
                const normalizedUrl = this.normalizeUrl(rawUrl);
                if (!normalizedUrl) {
                    console.warn('Navigation aborted: invalid input', rawUrl);
                    return;
                }

                if (normalizedUrl.startsWith('chrome://')) {
                    if (normalizedUrl === 'chrome://newtab') {
                        this.showNewTabPage();
                        this.updateCurrentTab({ url: normalizedUrl, title: 'New Tab' });
                        return;
                    }

                    alert('This internal page is not implemented yet.');
                    return;
                }

                this.addressBar.value = normalizedUrl;

                const tab = this.tabs.get(this.currentTabId);
                if (!tab) return;

                tab.url = normalizedUrl;
                tab.title = 'Loading...';
                this.updateTabTitle(tab.id, tab.title);

                this.addToHistory({
                    url: normalizedUrl,
                    title: 'Loading...',
                    timestamp: new Date().toISOString()
                });

                const activeView = this.ensureWebview(this.currentTabId);
                if (!activeView) return;

                this.setActiveWebview(this.currentTabId);

                if (this.isWebviewReady(this.currentTabId)) {
                    activeView.src = normalizedUrl;
                } else {
                    this.pendingNavigations.set(this.currentTabId, normalizedUrl);
                }
                this.showWebview();

                this.loadingBar.classList.add('active');
                this.loadingStatus.textContent = 'Loading...';
                this.updateSecurityIndicator();
            }
            
            goBack() {
                const activeView = this.getActiveWebview();
                if (!activeView || !this.isWebviewReady(this.currentTabId)) return;
                if (activeView.canGoBack()) {
                    activeView.goBack();
                }
            }

            goForward() {
                const activeView = this.getActiveWebview();
                if (!activeView || !this.isWebviewReady(this.currentTabId)) return;
                if (activeView.canGoForward()) {
                    activeView.goForward();
                }
            }

            reload() {
                const activeView = this.getActiveWebview();
                if (!activeView || !this.isWebviewReady(this.currentTabId)) return;
                const currentTab = this.getCurrentTab();
                if (!currentTab || currentTab.url === 'chrome://newtab') {
                    this.showNewTabPage();
                } else {
                    activeView.reload();
                }
            }

            goHome() {
                this.showNewTabPage();
                this.updateCurrentTab({ url: 'chrome://newtab', title: 'New Tab' });
            }
            
            // Tab Management
            createNewTab(url = 'chrome://newtab') {
                this.nextTabId++;
                const tabId = this.nextTabId.toString();

                const tab = {
                    id: tabId,
                    title: 'New Tab',
                    url: url,
                    favicon: 'üåê',
                    isActive: false,
                    canGoBack: false,
                    canGoForward: false,
                    isLoading: false
                };

                this.tabs.set(tabId, tab);
                this.addTabToUI(tab);
                this.ensureWebview(tabId);
                this.switchToTab(tabId);

                if (url !== 'chrome://newtab') {
                    this.navigate(url);
                }
            }

            closeTab(tabId) {
                if (this.tabs.size <= 1) return; // Don't close last tab

                this.tabs.delete(tabId);
                document.querySelector(`[data-tab-id="${tabId}"]`).remove();

                const webview = this.webviews.get(tabId);
                if (webview) {
                    webview.remove();
                    this.webviews.delete(tabId);
                    this.webviewReadyState.delete(tabId);
                    this.pendingNavigations.delete(tabId);
                }

                if (this.currentTabId === tabId) {
                    // Switch to first available tab
                    const firstTab = this.tabs.keys().next().value;
                    this.switchToTab(firstTab);
                }
            }

            switchToTab(tabId) {
                // Update UI
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab-id="${tabId}"]`).classList.add('active');
                
                // Update current tab
                this.currentTabId = tabId;
                const tab = this.tabs.get(tabId);
                
                if (tab) {
                    this.addressBar.value = tab.url;
                    this.updateNavigationButtons();

                    if (tab.url === 'chrome://newtab') {
                        this.showNewTabPage();
                        this.setActiveWebview(tabId);
                    } else {
                        this.showWebview();
                        this.setActiveWebview(tabId);
                        const activeView = this.getActiveWebview();
                        if (activeView && activeView.src !== tab.url) {
                            activeView.src = tab.url;
                        }
                    }
                }
            }

            addTabToUI(tab) {
                const tabElement = document.createElement('div');
                tabElement.className = 'tab';
                tabElement.setAttribute('data-tab-id', tab.id);

                const faviconElement = document.createElement('div');
                faviconElement.className = 'tab-favicon';
                faviconElement.textContent = tab.favicon;

                const titleElement = document.createElement('div');
                titleElement.className = 'tab-title';
                titleElement.textContent = tab.title;

                const closeButton = document.createElement('button');
                closeButton.className = 'tab-close';
                closeButton.type = 'button';
                closeButton.setAttribute('data-tab-close', tab.id);
                closeButton.innerHTML = '<i class="fas fa-times"></i>';

                tabElement.appendChild(faviconElement);
                tabElement.appendChild(titleElement);
                tabElement.appendChild(closeButton);

                document.querySelector('.new-tab-btn').before(tabElement);
            }
            
            // Webview Events
            onStartLoading(tabId) {
                this.loadingBar.classList.add('active');
                this.loadingStatus.textContent = 'Loading...';
                if (this.currentTabId === tabId) {
                    this.updateCurrentTab({ isLoading: true });
                }
            }

            onStopLoading(tabId) {
                this.loadingBar.classList.remove('active');
                this.loadingStatus.textContent = '';

                // Update current tab
                const tab = this.tabs.get(tabId);
                const webview = this.webviews.get(tabId);
                if (tab && webview) {
                    // Update tab title from webview
                    tab.title = webview.getTitle() || tab.url;
                    tab.url = webview.getURL();

                    // Update history with final title
                    if (this.history.length > 0) {
                        const lastEntry = this.history[this.history.length - 1];
                        if (lastEntry && lastEntry.url === tab.url) {
                            lastEntry.title = tab.title;
                            this.saveHistory();
                        }
                    }
                    
                    this.updateTabTitle(tab.id, tab.title);
                    if (this.currentTabId === tabId) {
                        this.addressBar.value = tab.url;
                    }
                }

                if (this.currentTabId === tabId) {
                    this.updateCurrentTab({ isLoading: false });
                }
            }

            onNavigate(e, tabId) {
                const tab = this.tabs.get(tabId);
                if (tab) {
                    tab.url = e.url;
                    if (this.currentTabId === tabId) {
                        this.addressBar.value = e.url;
                        this.updateSecurityIndicator();
                        this.updateNavigationButtons();
                        this.pageStatus.textContent = `Navigated to ${new URL(e.url).hostname}`;
                    }
                }
            }

            onNavigateInPage(e, tabId) {
                const tab = this.tabs.get(tabId);
                if (tab) {
                    tab.url = e.url;
                    if (this.currentTabId === tabId) {
                        this.addressBar.value = e.url;
                        this.updateNavigationButtons();
                    }
                }
            }

            onTitleUpdate(e, tabId) {
                const tab = this.tabs.get(tabId);
                if (tab) {
                    tab.title = e.title;
                    this.updateTabTitle(tabId, e.title);
                    if (this.currentTabId === tabId) {
                        this.pageStatus.textContent = e.title;
                    }
                }
            }

            onLoadFail(e, tabId) {
                this.loadingBar.classList.remove('active');
                if (this.currentTabId === tabId) {
                    this.pageStatus.textContent = `Failed to load: ${e.errorDescription}`;
                    this.loadingStatus.textContent = 'Load failed';
                }
            }

            onNewWindow(e) {
                e.preventDefault();
                this.createNewTab(e.url);
            }

            onDomReady(tabId) {
                this.setWebviewReady(tabId, true);
                const pending = this.pendingNavigations.get(tabId);
                if (pending) {
                    this.pendingNavigations.delete(tabId);
                    const webview = this.webviews.get(tabId);
                    if (webview) {
                        webview.src = pending;
                    }
                }

                if (this.currentTabId === tabId) {
                    this.pageStatus.textContent = 'Page loaded';
                }
            }
            
            // UI Updates
            updateCurrentTab(updates) {
                const tab = this.tabs.get(this.currentTabId);
                if (tab) {
                    Object.assign(tab, updates);
                }
            }
            
            updateTabTitle(tabId, title) {
                const tabElement = document.querySelector(`[data-tab-id="${tabId}"] .tab-title`);
                if (tabElement) {
                    tabElement.textContent = title.length > 20 ? title.substring(0, 20) + '...' : title;
                }
            }
            
            updateNavigationButtons() {
                const activeView = this.getActiveWebview();
                if (!activeView || !activeView.isConnected) {
                    this.backBtn.disabled = true;
                    this.forwardBtn.disabled = true;
                    return;
                }

                try {
                    this.backBtn.disabled = !activeView.canGoBack();
                    this.forwardBtn.disabled = !activeView.canGoForward();
                } catch (error) {
                    console.warn('Navigation buttons unavailable yet:', error);
                    this.backBtn.disabled = true;
                    this.forwardBtn.disabled = true;
                }
            }
            
            updateSecurityIndicator() {
                const url = this.addressBar.value;
                const icon = this.securityIndicator.querySelector('i');
                
                if (url.startsWith('https://')) {
                    icon.className = 'fas fa-lock';
                    icon.style.color = 'var(--v3x-success)';
                } else if (url.startsWith('http://')) {
                    icon.className = 'fas fa-exclamation-triangle';
                    icon.style.color = 'var(--v3x-warning)';
                } else {
                    icon.className = 'fas fa-info-circle';
                    icon.style.color = 'var(--chrome-text-secondary)';
                }
            }
            
            showNewTabPage() {
                this.newTabPage.classList.remove('hidden');
                this.newTabPage.style.display = 'flex';
                this.newTabPage.scrollTop = 0;
                this.webviewContainer.classList.add('hidden');
                this.webviewContainer.style.display = 'none';
                this.addressBar.value = 'chrome://newtab';
                this.updateCurrentTab({ url: 'chrome://newtab', title: 'New Tab' });
            }
            
            showWebview() {
                this.newTabPage.classList.add('hidden');
                this.newTabPage.style.display = 'none';
                this.webviewContainer.classList.remove('hidden');
                this.webviewContainer.style.display = 'block';
            }
            
            // Utility Functions
            getCurrentTab() {
                return this.tabs.get(this.currentTabId);
            }
            
            selectAddressBar() {
                this.addressBar.select();
            }
            
            onAddressInput() {
                // Could add suggestions here
            }
            
            addToHistory(entry) {
                // Don't add duplicate consecutive entries
                const lastEntry = this.history[this.history.length - 1];
                if (lastEntry && lastEntry.url === entry.url) {
                    return;
                }
                
                // Add new entry
                this.history.push(entry);
                
                // Keep history size manageable (last 1000 entries)
                if (this.history.length > 1000) {
                    this.history.shift();
                }
                
                // Save to storage
                this.saveHistory();
            }
            
            // Bookmarks
            toggleBookmark() {
                const currentTab = this.getCurrentTab();
                if (!currentTab || currentTab.url === 'chrome://newtab') return;
                
                const isBookmarked = this.bookmarks.some(b => b.url === currentTab.url);
                
                if (isBookmarked) {
                    this.removeBookmark(currentTab.url);
                    this.bookmarkIcon.style.color = 'var(--chrome-text-secondary)';
                } else {
                    this.addBookmark(currentTab.title, currentTab.url);
                    this.bookmarkIcon.style.color = 'var(--v3x-warning)';
                }
            }
            
            addBookmark(title, url) {
                if (!title) {
                    title = url;
                }

                const existing = this.bookmarks.find(b => b.url === url);
                if (existing) {
                    existing.title = title;
                    existing.timestamp = Date.now();
                } else {
                    this.bookmarks.push({ title, url, timestamp: Date.now() });
                }

                this.saveBookmarks();
                this.renderBookmarksBar();
            }
            
            removeBookmark(url) {
                this.bookmarks = this.bookmarks.filter(b => b.url !== url);
                this.saveBookmarks();
                this.renderBookmarksBar();
            }
            
            navigateToBookmark(url) {
                this.navigate(url);
            }
            
            // Storage
            loadBookmarks() {
                try {
                    const stored = JSON.parse(localStorage.getItem('v3x_bookmarks') || '[]');
                    if (Array.isArray(stored)) {
                        return stored.filter(entry => entry && entry.url);
                    }
                    return [];
                } catch {
                    return [];
                }
            }
            
            saveBookmarks() {
                localStorage.setItem('v3x_bookmarks', JSON.stringify(this.bookmarks));
            }

            renderBookmarksBar() {
                if (!this.bookmarksBar) return;

                // Preserve built-in entries with data-static-bookmark
                const staticButtons = Array.from(this.bookmarksBar.querySelectorAll('[data-static-bookmark]'));
                this.bookmarksBar.innerHTML = '';
                staticButtons.forEach(btn => this.bookmarksBar.appendChild(btn));

                if (this.bookmarks.length === 0) {
                    this.bookmarksBar.classList.add('bookmarks-empty');
                } else {
                    this.bookmarksBar.classList.remove('bookmarks-empty');
                }

                this.bookmarks
                    .sort((a, b) => (a.title || a.url).localeCompare(b.title || b.url))
                    .forEach(bookmark => {
                        const button = document.createElement('button');
                        button.className = 'bookmark';
                        button.type = 'button';
                        button.setAttribute('data-bookmark-url', bookmark.url);

                        const icon = document.createElement('div');
                        icon.className = 'bookmark-icon';
                        icon.textContent = 'üîñ';

                        const label = document.createElement('span');
                        label.textContent = bookmark.title?.trim() || bookmark.url;

                        button.appendChild(icon);
                        button.appendChild(label);
                        this.bookmarksBar.appendChild(button);
                    });

                this.renderBookmarksManager();
                this.renderFloatingBookmarks();
            }

            renderFloatingBookmarks() {
                if (!this.floatingBookmarksGrid) {
                    return;
                }

                const container = this.floatingBookmarksGrid;
                const emptyState = document.getElementById('floatingBookmarksEmpty');

                container.querySelectorAll('.bookmark-card').forEach((node) => node.remove());

                if (!this.bookmarks || this.bookmarks.length === 0) {
                    if (emptyState) {
                        emptyState.classList.remove('hidden');
                    }
                    if (this.bookmarkCountLabel) {
                        this.bookmarkCountLabel.textContent = 'No bookmarks yet';
                    }
                    return;
                }

                if (emptyState) {
                    emptyState.classList.add('hidden');
                }

                if (this.bookmarkCountLabel) {
                    this.bookmarkCountLabel.textContent = `${this.bookmarks.length} saved`;
                }

                const fragment = document.createDocumentFragment();
                const maxCards = Math.min(this.bookmarks.length, 12);

                this.bookmarks
                    .slice(0, maxCards)
                    .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0))
                    .forEach((bookmark, index) => {
                        const card = document.createElement('div');
                        card.className = 'bookmark-card';
                        card.setAttribute('data-bookmark-url', bookmark.url);
                        card.style.animationDelay = `${index * 0.12}s`;

                        const heading = document.createElement('h3');
                        heading.textContent = bookmark.title?.trim() || new URL(bookmark.url).hostname;

                        const description = document.createElement('p');
                        description.textContent = 'Tap to launch instantly';

                        const url = document.createElement('span');
                        url.className = 'bookmark-url';
                        url.textContent = bookmark.url;

                        card.appendChild(heading);
                        card.appendChild(description);
                        card.appendChild(url);

                        fragment.appendChild(card);
                    });

                container.appendChild(fragment);
            }

            initializeBookmarkManager() {
                if (this.bookmarkPanelListeners) {
                    return;
                }

                if (!this.bookmarksManager || !this.bookmarksList) {
                    console.warn('Bookmark manager UI is not available.');
                    return;
                }

                const handleSearchInput = () => {
                    this.renderBookmarksManager();
                };

                const handleClose = () => {
                    this.hideBookmarks();
                };

                const handleKeyDown = (event) => {
                    if (event.key === 'Escape' && !this.bookmarksManager.classList.contains('hidden')) {
                        this.hideBookmarks();
                    }
                };

                const handleDocumentClick = (event) => {
                    if (this.bookmarksManager.classList.contains('hidden')) {
                        return;
                    }

                    if (this.bookmarksManager.contains(event.target)) {
                        return;
                    }

                    const trigger = document.querySelector('[data-menu-action="openBookmarks"]');
                    if (trigger && trigger.contains(event.target)) {
                        return;
                    }

                    this.hideBookmarks();
                };

                const handleListClick = (event) => {
                    const actionBtn = event.target.closest('[data-bookmark-action]');
                    if (!actionBtn) return;

                    const action = actionBtn.getAttribute('data-bookmark-action');
                    const url = actionBtn.getAttribute('data-bookmark-url');
                    if (!action || !url) return;

                    if (action === 'open') {
                        this.hideBookmarks();
                        this.navigate(url);
                    }

                    if (action === 'remove') {
                        this.removeBookmark(url);
                    }
                };

                if (this.bookmarkSearchInput) {
                    this.bookmarkSearchInput.addEventListener('input', handleSearchInput);
                }

                if (this.bookmarksCloseBtn) {
                    this.bookmarksCloseBtn.addEventListener('click', handleClose);
                }

                this.bookmarksList.addEventListener('click', handleListClick);
                document.addEventListener('keydown', handleKeyDown);
                document.addEventListener('click', handleDocumentClick);

                this.bookmarkPanelListeners = {
                    handleSearchInput,
                    handleClose,
                    handleKeyDown,
                    handleDocumentClick,
                    handleListClick
                };
            }

            renderBookmarksManager() {
                if (!this.bookmarksList) {
                    return;
                }

                const query = (this.bookmarkSearchInput?.value || '').trim().toLowerCase();
                const filtered = this.bookmarks.filter((bookmark) => {
                    if (!bookmark || !bookmark.url) return false;
                    if (!query) return true;
                    const title = bookmark.title || '';
                    return title.toLowerCase().includes(query) || bookmark.url.toLowerCase().includes(query);
                });

                if (filtered.length === 0) {
                    this.bookmarksList.innerHTML = '<div class="empty-state">No bookmarks saved yet</div>';
                    return;
                }

                const fragment = document.createDocumentFragment();

                filtered
                    .sort((a, b) => (a.title || a.url).localeCompare(b.title || b.url))
                    .forEach((bookmark) => {
                        const item = document.createElement('div');
                        item.className = 'bookmark-item';

                        const info = document.createElement('div');
                        info.className = 'bookmark-info';

                        const title = document.createElement('div');
                        title.className = 'title';
                        title.textContent = bookmark.title?.trim() || bookmark.url;

                        const url = document.createElement('div');
                        url.className = 'url';
                        url.textContent = bookmark.url;

                        info.appendChild(title);
                        info.appendChild(url);

                        const actions = document.createElement('div');
                        actions.className = 'bookmark-actions';

                        const openBtn = document.createElement('button');
                        openBtn.type = 'button';
                        openBtn.textContent = 'Open';
                        openBtn.setAttribute('data-bookmark-action', 'open');
                        openBtn.setAttribute('data-bookmark-url', bookmark.url);

                        const removeBtn = document.createElement('button');
                        removeBtn.type = 'button';
                        removeBtn.textContent = 'Delete';
                        removeBtn.setAttribute('data-bookmark-action', 'remove');
                        removeBtn.setAttribute('data-bookmark-url', bookmark.url);

                        actions.appendChild(openBtn);
                        actions.appendChild(removeBtn);

                        item.appendChild(info);
                        item.appendChild(actions);

                        fragment.appendChild(item);
                    });

                this.bookmarksList.innerHTML = '';
                this.bookmarksList.appendChild(fragment);
            }

            loadHistory() {
                try {
                    return JSON.parse(localStorage.getItem('v3x_history') || '[]');
                } catch (e) {
                    console.error('Error loading history:', e);
                    return [];
                }
            }
            
            saveHistory() {
                try {
                    localStorage.setItem('v3x_history', JSON.stringify(this.history));
                } catch (e) {
                    console.error('Error saving history:', e);
                }
            }
            
            // History Management
            showHistory() {
                if (!this.historyPanel || !this.historyList) {
                    this.initializeHistoryPanel();
                }
                
                if (!this.historyPanel || !this.historyList) {
                    console.warn('History panel UI is not available.');
                    return;
                }
                
                this.historyList.innerHTML = '';
                
                if (this.history.length === 0) {
                    this.historyList.innerHTML = '<div class="empty-state">No browsing history</div>';
                    this.historyPanel.classList.add('active');
                    return;
                }
                
                const historyByDate = new Map();
                this.history.forEach((entry, entryIndex) => {
                    const dateLabel = new Date(entry.timestamp).toLocaleDateString();
                    if (!historyByDate.has(dateLabel)) {
                        historyByDate.set(dateLabel, []);
                    }
                    historyByDate.get(dateLabel).push({ entry, entryIndex });
                });
                
                historyByDate.forEach((entries, dateLabel) => {
                    const dateHeader = document.createElement('div');
                    dateHeader.className = 'history-date';
                    dateHeader.textContent = dateLabel;
                    this.historyList.appendChild(dateHeader);
                    
                    entries.forEach(({ entry, entryIndex }) => {
                        const historyItem = document.createElement('div');
                        historyItem.className = 'history-item';
                        
                        const favicon = document.createElement('div');
                        favicon.className = 'history-favicon';
                        favicon.textContent = '';
                        
                        const details = document.createElement('div');
                        details.className = 'history-details';
                        
                        const title = document.createElement('div');
                        title.className = 'history-title';
                        title.textContent = entry.title || entry.url;
                        
                        const url = document.createElement('div');
                        url.className = 'history-url';
                        url.textContent = entry.url;
                        
                        const time = document.createElement('div');
                        time.className = 'history-time';
                        time.textContent = new Date(entry.timestamp).toLocaleTimeString();
                        
                        details.appendChild(title);
                        details.appendChild(url);
                        
                        historyItem.appendChild(favicon);
                        historyItem.appendChild(details);
                        historyItem.appendChild(time);
                        
                        historyItem.addEventListener('click', (event) => {
                            event.stopPropagation();
                            this.navigate(entry.url);
                            this.hideHistory();
                        });
                        
                        historyItem.addEventListener('contextmenu', (event) => {
                            event.preventDefault();
                            this.showHistoryContextMenu(event, entry, entryIndex);
                        });
                        
                        this.historyList.appendChild(historyItem);
                    });
                });
                
                const mainMenu = document.getElementById('mainMenu');
                if (mainMenu) {
                    mainMenu.classList.remove('active');
                }
                
                this.historyPanel.classList.add('active');
            }
            
            hideHistory() {
                if (!this.historyPanel) {
                    return;
                }
                
                this.historyPanel.classList.remove('active');
                
                const existingMenu = document.getElementById('historyContextMenu');
                if (existingMenu) {
                    existingMenu.remove();
                }
            }

            showBookmarks() {
                if (!this.bookmarksManager || !this.bookmarksList) {
                    this.initializeBookmarkManager();
                }

                if (!this.bookmarksManager) {
                    console.warn('Bookmark manager UI is not available.');
                    return;
                }

                this.renderBookmarksManager();

                this.bookmarksManager.classList.remove('hidden');
                this.bookmarksManager.setAttribute('aria-hidden', 'false');

                const searchInput = this.bookmarkSearchInput;
                if (searchInput) {
                    searchInput.focus();
                    searchInput.select();
                }
            }

            hideBookmarks() {
                if (!this.bookmarksManager) {
                    return;
                }

                this.bookmarksManager.classList.add('hidden');
                this.bookmarksManager.setAttribute('aria-hidden', 'true');
            }
            
            clearHistory() {
                if (confirm('Are you sure you want to clear all browsing history?')) {
                    this.history = [];
                    this.saveHistory();
                    this.showHistory();
                }
            }
            
            removeHistoryItem(index) {
                if (index >= 0 && index < this.history.length) {
                    this.history.splice(index, 1);
                    this.saveHistory();
                    this.showHistory();
                }
            }
            
            showHistoryContextMenu(event, entry, index) {
                // Remove any existing context menu
                const existingMenu = document.getElementById('historyContextMenu');
                if (existingMenu) {
                    existingMenu.remove();
                }
                
                // Create context menu
                const menu = document.createElement('div');
                menu.id = 'historyContextMenu';
                menu.className = 'context-menu';
                
                // Position the menu
                menu.style.top = `${event.pageY}px`;
                menu.style.left = `${event.pageX}px`;
                
                // Add menu items
                const items = [
                    { text: 'Open', icon: '', action: () => { this.navigate(entry.url); this.hideHistory(); } },
                    { text: 'Open in New Tab', icon: '', action: () => this.createNewTab(entry.url) },
                    { text: 'Copy URL', icon: '', action: () => this.copyToClipboard(entry.url) },
                    { text: 'Remove from History', icon: '', action: () => this.removeHistoryItem(index) },
                    { text: 'Clear All History', icon: '', action: () => this.clearHistory() }
                ];
                
                items.forEach(item => {
                    const menuItem = document.createElement('div');
                    menuItem.className = 'context-menu-item';
                    menuItem.innerHTML = `<span class="menu-icon">${item.icon}</span> ${item.text}`;
                    menuItem.addEventListener('click', (clickEvent) => {
                        clickEvent.stopPropagation();
                        item.action();
                        menu.remove();
                    });
                    menu.appendChild(menuItem);
                });
                
                // Add to document
                document.body.appendChild(menu);
                
                // Close menu when clicking outside
                const closeMenu = (closeEvent) => {
                    if (!menu.contains(closeEvent.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                };
                
                setTimeout(() => {
                    document.addEventListener('click', closeMenu);
                }, 100);
            }
            
            copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    console.log('Copied to clipboard');
                }).catch(err => {
                    console.error('Failed to copy:', err);
                });
            }
            
            // Time Updates
            updateTime() {
                const now = new Date();
                this.currentTimeEl.textContent = now.toLocaleTimeString();
                setTimeout(() => this.updateTime(), 1000);
            }
            
            // Keyboard Shortcuts
            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 't':
                                e.preventDefault();
                                this.createNewTab();
                                break;
                            case 'w':
                                e.preventDefault();
                                this.closeTab(this.currentTabId);
                                break;
                            case 'r':
                                e.preventDefault();
                                this.reload();
                                break;
                            case 'l':
                                e.preventDefault();
                                this.addressBar.focus();
                                this.addressBar.select();
                                break;
                            case 'ArrowLeft':
                                e.preventDefault();
                                this.goBack();
                                break;
                            case 'ArrowRight':
                                e.preventDefault();
                                this.goForward();
                                break;
                            case 'd':
                                e.preventDefault();
                                this.toggleBookmark();
                                break;
                        }
                    }
                    
                    if (e.key === 'F12') {
                        e.preventDefault();
                        this.openDevTools();
                    }
                });
            }
            
            // Menu Functions
            closeDropdowns(e) {
                if (!e.target.closest('.menu-btn')) {
                    document.querySelectorAll('.dropdown').forEach(dropdown => {
                        dropdown.classList.remove('active');
                    });
                }
            }
            
            // Menu Actions
            openNewTab() { this.createNewTab(); }
            openNewWindow() { console.log('Open new window'); }
            openIncognito() { console.log('Open incognito window'); }
            openHistory() {
                this.showHistory();
            }

            openDownloads() {
                console.warn('Downloads page is not implemented yet.');
                alert('Downloads panel is coming soon.');
            }

            openBookmarks() {
                this.showBookmarks();
            }

            openSettings() {
                console.warn('Settings page is not implemented yet.');
                alert('Settings page is coming soon.');
            }
            
            openDevTools() {
                try {
                    if (!this.webview) {
                        console.error('WebView is not initialized');
                        return;
                    }
                    
                    if (this.webview.isDevToolsOpened && this.webview.isDevToolsOpened()) {
                        this.webview.closeDevTools();
                        console.log('Developer tools closed');
                    } else if (this.webview.openDevTools) {
                        this.webview.openDevTools();
                        console.log('Developer tools opened');
                    } else {
                        console.error('Developer tools are not available in this environment');
                        alert('Developer tools are not available in this environment.');
                    }
                } catch (error) {
                    console.error('Error in openDevTools:', error);
                    alert('Error opening developer tools: ' + error.message);
                }
            }
            
            showAbout() {
                alert('V3X Browser - Professional Edition\\nVeni Vidi Vici\\nVersion 1.0.0\\nBuilt with Electron and modern web technologies');
            }
            
            toggleMainMenu() {
                const menu = document.getElementById('mainMenu');
                menu.classList.toggle('active');
            }
        }
        
        // Global Functions (for onclick handlers)
        let browser;
        
        function initBrowser() {
            browser = new V3XBrowser();
        }
        
        function handleKeyPress(event) {
            if (!browser) {
                console.warn('Browser not ready yet');
                return;
            }
            if (event.key === 'Enter') {
                browser.navigate(browser.addressBar.value);
            }
        }

        const ensureBrowser = (action) => {
            if (!browser) {
                console.warn('Browser not ready yet');
                return () => {};
            }
            return action;
        };

        function goBack() { ensureBrowser(() => browser.goBack())(); }
        function goForward() { ensureBrowser(() => browser.goForward())(); }
        function reload() { ensureBrowser(() => browser.reload())(); }
        function goHome() { ensureBrowser(() => browser.goHome())(); }
        function createNewTab() { ensureBrowser(() => browser.createNewTab())(); }
        function closeTab(id) { ensureBrowser(() => browser.closeTab(id))(); }
        function navigateToBookmark(url) { ensureBrowser(() => browser.navigateToBookmark(url))(); }
        function selectAddressBar() { ensureBrowser(() => browser.selectAddressBar())(); }
        function updateSecurityIndicator() { ensureBrowser(() => browser.updateSecurityIndicator())(); }

        // Menu functions
        function minimizeWindow() { console.log('Minimize window'); }
        function maximizeWindow() { console.log('Maximize window'); }
        function closeWindow() { console.log('Close window'); }
        function toggleMainMenu() { ensureBrowser(() => browser.toggleMainMenu())(); }
        function toggleBookmark() { ensureBrowser(() => browser.toggleBookmark())(); }
        function toggleDownloads() { console.log('Toggle downloads'); }
        function toggleExtensions() { console.log('Toggle extensions'); }
        function toggleProfile() { console.log('Toggle profile'); }
        function openNewTab() { ensureBrowser(() => browser.openNewTab())(); }
        function openNewWindow() { console.log('Open new window'); }
        function openIncognito() { console.log('Open incognito window'); }
        function openHistory() { ensureBrowser(() => browser.openHistory())(); }
        function openDownloads() { console.log('Open downloads'); }
        function openBookmarks() { ensureBrowser(() => browser.openBookmarks())(); }
        function openSettings() { console.log('Open settings'); }
        function openDevTools() { ensureBrowser(() => browser.openDevTools())(); }
        function showAbout() { ensureBrowser(() => browser.showAbout())(); }
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initBrowser);
        
        console.log('üéØ V3X Browser Professional Edition - Script Loaded');
    </script>

    <div id="bookmarksManager" class="side-panel hidden" aria-hidden="true">
        <div class="side-panel-header">
            <h3><i class="fas fa-bookmark"></i> Bookmarks</h3>
            <div class="side-panel-actions">
                <input type="text" id="bookmarkSearch" placeholder="Search bookmarks" aria-label="Search bookmarks" />
                <button type="button" id="bookmarksCloseBtn" class="close-button" aria-label="Close">&times;</button>
            </div>
        </div>
        <div class="side-panel-content">
            <div id="bookmarksList" class="list"></div>
        </div>
        <div class="side-panel-footer">
            <small>Right-click entries for actions.</small>
        </div>
    </div>
</body>
</html>
